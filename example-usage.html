<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Uploader Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            border-color: #4CAF50;
            background-color: #f9f9f9;
        }
        .upload-area.dragging {
            border-color: #2196F3;
            background-color: #e3f2fd;
        }
        .progress-container {
            margin-top: 20px;
        }
        .file-progress {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }
        .btn-secondary {
            background-color: #2196F3;
            color: white;
        }
        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üì§ Chunked File Uploader Demo</h1>
    
    <div class="upload-area" id="uploadArea">
        <p>üìÅ Drag & drop files here or click to select</p>
        <p style="font-size: 12px; color: #666;">Supports large files with automatic chunking</p>
        <input type="file" id="fileInput" multiple style="display: none;">
    </div>
    
    <div class="controls">
        <button class="btn-primary" id="uploadBtn" disabled>Start Upload</button>
        <button class="btn-secondary" id="pauseBtn" disabled>Pause</button>
        <button class="btn-secondary" id="resumeBtn" disabled>Resume</button>
        <button class="btn-danger" id="cancelBtn" disabled>Cancel</button>
    </div>
    
    <div class="progress-container" id="progressContainer"></div>
    
    <div class="stats" id="stats" style="display: none;"></div>

    <script type="module">
        // Import the FileUploader class (adjust path as needed)
        import { FileUploader } from './FileUploader.js';
        
        let uploader = null;
        let selectedFiles = [];
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const progressContainer = document.getElementById('progressContainer');
        const statsDiv = document.getElementById('stats');
        
        // Click to select files
        uploadArea.addEventListener('click', () => fileInput.click());
        
        // File selection
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
        
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragging');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragging');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragging');
            handleFiles(e.dataTransfer.files);
        });
        
        function handleFiles(files) {
            selectedFiles = Array.from(files);
            
            // Create uploader instance
            uploader = new FileUploader({
                endpoint: './upload-endpoint.php',
                chunkSize: 1024 * 1024, // 1MB chunks
                maxConcurrentUploads: 3,
                maxRetries: 3
            });
            
            // Add files
            uploader.addFiles(selectedFiles);
            
            // Set up progress callback
            uploader.onProgress((progress) => {
                updateProgress(progress);
            });
            
            // Set up completion callback
            uploader.onComplete((stats) => {
                showStats(stats);
                uploadBtn.disabled = true;
                pauseBtn.disabled = true;
                resumeBtn.disabled = true;
                cancelBtn.disabled = true;
            });
            
            // Set up error callback
            uploader.onError((error, fileName) => {
                console.error(`Error uploading ${fileName}:`, error);
            });
            
            uploadBtn.disabled = false;
            cancelBtn.disabled = false;
        }
        
        uploadBtn.addEventListener('click', async () => {
            uploadBtn.disabled = true;
            pauseBtn.disabled = false;
            cancelBtn.disabled = false;
            
            try {
                await uploader.upload();
            } catch (error) {
                console.error('Upload failed:', error);
                alert('Upload failed: ' + error.message);
            }
        });
        
        pauseBtn.addEventListener('click', () => {
            uploader.pause();
            pauseBtn.disabled = true;
            resumeBtn.disabled = false;
        });
        
        resumeBtn.addEventListener('click', async () => {
            resumeBtn.disabled = true;
            pauseBtn.disabled = false;
            await uploader.resume();
        });
        
        cancelBtn.addEventListener('click', () => {
            uploader.cancel();
            progressContainer.innerHTML = '';
            statsDiv.style.display = 'none';
            uploadBtn.disabled = true;
            pauseBtn.disabled = true;
            resumeBtn.disabled = true;
            cancelBtn.disabled = true;
        });
        
        function updateProgress(progressArray) {
            progressContainer.innerHTML = '';
            
            progressArray.forEach(progress => {
                const div = document.createElement('div');
                div.className = 'file-progress';
                
                const speedMB = (progress.speed / (1024 * 1024)).toFixed(2);
                const remaining = formatTime(progress.remainingTime);
                
                div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <strong>${progress.fileName}</strong>
                        <span>${progress.status}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress.percentage}%">
                            ${progress.percentage.toFixed(1)}%
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        ${formatBytes(progress.uploadedSize)} / ${formatBytes(progress.totalSize)} 
                        ‚Ä¢ ${speedMB} MB/s 
                        ‚Ä¢ ${remaining} remaining
                    </div>
                `;
                
                progressContainer.appendChild(div);
            });
        }
        
        function showStats(stats) {
            statsDiv.style.display = 'block';
            statsDiv.innerHTML = `
                <h3>Upload Complete! ‚úÖ</h3>
                <p><strong>Total Files:</strong> ${stats.totalFiles}</p>
                <p><strong>Completed:</strong> ${stats.completedFiles}</p>
                <p><strong>Failed:</strong> ${stats.failedFiles}</p>
                <p><strong>Total Size:</strong> ${formatBytes(stats.totalBytes)}</p>
                <p><strong>Duration:</strong> ${stats.duration?.toFixed(2)} seconds</p>
                <p><strong>Average Speed:</strong> ${formatBytes(stats.totalBytes / (stats.duration || 1))} /s</p>
            `;
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatTime(seconds) {
            if (seconds < 60) return `${Math.round(seconds)}s`;
            const minutes = Math.floor(seconds / 60);
            const secs = Math.round(seconds % 60);
            return `${minutes}m ${secs}s`;
        }
    </script>
</body>
</html>

